- !Meta
  description: |
    Project command-line interface

- !ShellCommand
  name: app echo
  description: Echo greeting
  image: app.env.ansible
  params:
    - !Argument {name: name, default: World}
  shell: echo "Hello {{name}}!!!"

- !SubCommand
  name: ping
  image: !DockerImage ubuntu:xenial
  call: ping

- !SubCommand
  name: shell
  image: !DockerImage ubuntu:xenial
  call: /bin/bash
  raw-input: true
  ports:
    - !Expose { port: 8000, as: 8080 }

- !Service
  name: redis
  image: !DockerImage redis:latest
  ports:
    - !Expose { port: 6379, as: 6379 }

- !Image
  name: env
  repository: reg.local/env
  provision-with: !Dockerfile Dockerfile.env

- !Image
  name: app.env.ansible
  from: env
  repository: reg.local/app.env.ansible
  provision-with: !AnsibleTasks
    - file: path=/app.env.ansible.txt state=touch

- !Image
  name: app.env.dockerfile
  from: env
  repository: reg.local/app.env.dockerfile
  provision-with: !Dockerfile Dockerfile.app.env


- !SubCommand
  name: test
  image: app.env.ansible
  call: echo
